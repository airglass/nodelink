<html>

<head>
  <title></title>
  <style>
    body {
      background-color: #fff;
      margin: 20px;
    }

    #wrap {
      position: relative;
      background-color: #9C27B0;
      border-radius: 6px;
      overflow: hidden;
    }

    #wrap canvas {
      position: absolute;
      top: 0;
      left: 0;
    }
  </style>
</head>

<body>
  <div id="wrap"></div>
  <div id="info"></div>
  <button id="play">Play</button>
  <script src="../airglass.js"></script>
  <script src="sketch.js"></script>
  <script>

    document.querySelector('#play').addEventListener('click', function(){
      play();
    })

    async function play() {
      let audioContext = new AudioContext();
      let arrayBuffer = await getArrayBuffer('bensound-summer.mp3');
      let audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
      let bufferSource = audioContext.createBufferSource();
      bufferSource.buffer = audioBuffer;
      bufferSource.connect(audioContext.destination)
      bufferSource.start(0);

      console.log(audioContext.destination)
    }

    async function decodeAudioData(arrayBuffer){
      return new Promises((resolve, reject) => {
        let audioContext = new AudioContext();
      })
    }

    async function getArrayBuffer(url) {
      return new Promise((resolve, reject) => {
        let client = new XMLHttpRequest();
        client.responseType = 'arraybuffer';
        client.onreadystatechange = function () {
          if (client.status == 200 && client.readyState == 4) {
            resolve(client.response);
          }
        }
        client.open('GET', url, true);
        client.send(null);
      })
    }
  </script>
</body>

</html>